---
import type { Widget } from "@meursyphus/flitter";
import SvelteWidget from "@meursyphus/flitter-svelte";
import { getCollection } from "astro:content";
import Layout from "../../layouts/ChartLayout.astro";
import Presentation from "./Presentation.astro";
import * as Showcase from "../../content/showcases/index";

export async function getStaticPaths() {
  const charts = await getCollection("charts");
  const showcases = await getCollection("showcases");

  return charts.map((entry) => {
    const { slug } = entry;
    const showcasesOnChart = showcases.filter(
      (showcase) => showcase.data.category === slug
    );
    type ShowcaseType = (typeof Showcase)[keyof typeof Showcase];
    Object.values(showcasesOnChart).reduce(
      (acc, showcase) => {
        acc[showcase.data.key] = {
          entry: showcase,
          widget:
            Showcase[slug as keyof typeof Showcase][showcase.data.key].widget,
        };

        return acc;
      },
      {} as Record<
        string,
        {
          entry: ShowcaseType;
          widget: Widget;
        }
      >
    );
    return {
      params: { slug },
      props: { entry, showcases: Showcase[slug as keyof typeof Showcase] },
    };
  });
}

const { entry, showcases } = Astro.props;

const hashtag = "chartjs-basic";
console.log(showcases[hashtag]);

const { Content } = await entry.render();
---

<Layout title="Bar Chart">
  <!--left side -->
  <div slot="description">
    <div class="h-[600px] bg-blue-300 overflow-y-scroll">
      <Content />
    </div>
    <div class="flex flex-col w-full bg-red-50">
      <div
        class="grid grid-cols-auto-fill justify-items-center gap-5 px-2 py-5"
      >
        {
          Object.entries(showcases).map(([key, showcase]) => (
            <div class="h-[150px] min-w-[150px] w-full bg-red-300">{key}</div>
          ))
        }
      </div>
    </div>
  </div>

  <!--right side -->
  <Presentation slot="presentation" client:load />
</Layout>

<style>
  .grid-cols-auto-fill {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }
</style>
